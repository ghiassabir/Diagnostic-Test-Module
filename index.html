<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostic Test Launcher</title>
    <style>
        body, html {
            margin: 0; padding: 0; height: 100%;
            font-family: 'Inter', sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f0f4f8; color: #1e293b;
            display: flex; justify-content: center; align-items: center;
        }
        .launcher-container {
            background-color: white; padding: 2.5rem 3rem; border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center;
            border: 1px solid #e2e8f0; max-width: 500px; width: 90%;
        }
        .launcher-header {
            display: flex; flex-direction: column; align-items: center;
            margin-bottom: 2rem; border-bottom: 1px solid #e2e8f0; padding-bottom: 1.5rem;
        }
        .launcher-logo { font-size: 1.75rem; font-weight: bold; color: #003366; margin-bottom: 0.5rem; }
        .launcher-title { font-size: 1.25rem; font-weight: 600; color: #475569; }
        .module-buttons-container { display: flex; flex-direction: column; gap: 1rem; margin-bottom: 2rem; }
        
        /* SIMPLIFIED BUTTON STYLING */
        .module-button {
            display: block; width: 100%; padding: 1rem; font-size: 1.125rem; font-weight: 600;
            border-radius: 0.5rem; border: 2px solid #a5b4fc; 
            cursor: pointer; text-decoration: none; transition: all 0.2s ease-in-out; 
            box-sizing: border-box; background-color: #e0e7ff; color: #3730a3;
            position: relative;
        }
        .module-button:hover {
            background-color: #c7d2fe;
            border-color: #818cf8;
        }
        .module-button.completed {
            background-color: #d1fae5; /* Light Green */
            color: #065f46; /* Dark Green Text */
            border-color: #6ee7b7;
        }
        .module-button.completed::after {
            content: 'âœ”';
            position: absolute;
            right: 1.25rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: #15803d;
        }

        .results-button {
            border-color: #d1d5db;
            background-color: #e5e7eb;
            color: #4b5563;
        }
        .results-button.active {
            background-color: #facc15;
            color: #422006;
            border-color: #facc15;
        }
        .results-button.active:hover {
            background-color: #eab308;
        }
    </style>
</head>
<body>
    <div class="launcher-container">
        <div class="launcher-header">
            <h1 class="launcher-logo">SAT Hub</h1>
            <h2 class="launcher-title">Diagnostic Test</h2>
        </div>
        
        <div class="module-buttons-container">
            <a id="module1-btn" data-module-key="DT-T0-RW-M1_completed" href="quiz.html?quiz_name=DT-T0-RW-M1&originPageId=index&source=diagnostic" class="module-button">Reading & Writing - Module 1</a>
            <a id="module2-btn" data-module-key="DT-T0-RW-M2_completed" href="quiz.html?quiz_name=DT-T0-RW-M2&originPageId=index&source=diagnostic" class="module-button">Reading & Writing - Module 2</a>
            <a id="module3-btn" data-module-key="DT-T0-MT-M1_completed" href="quiz.html?quiz_name=DT-T0-MT-M1&originPageId=index&source=diagnostic" class="module-button">Math - Module 1</a>
            <a id="module4-btn" data-module-key="DT-T0-MT-M2_completed" href="quiz.html?quiz_name=DT-T0-MT-M2&originPageId=index&source=diagnostic" class="module-button">Math - Module 2</a>
        </div>

        <a id="results-btn" href="YOUR_DASHBOARD_URL_HERE.html" class="module-button results-button">View Results</a>
        <button id="reset-progress-btn" style="margin-top: 1rem; font-size: 0.8rem; color: #64748b; background: none; border: none; cursor: pointer; text-decoration: underline;">Reset Progress</button>
    </div>

    <!-- Email Modal (No changes needed here) -->
    <div id="email-modal" class="modal-overlay"> <!-- ... --> </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const DIAGNOSTIC_STATE_KEY = 'diagnosticTestState';
            const emailModal = document.getElementById('email-modal'); // Assuming this exists
            const emailInput = document.getElementById('email-modal-input');
            const emailSubmitBtn = document.getElementById('email-modal-submit');
            let targetUrl = '';

            const getDiagnosticState = () => {
                const stateJSON = localStorage.getItem(DIAGNOSTIC_STATE_KEY);
                return stateJSON ? JSON.parse(stateJSON) : {};
            };

            const updateVisuals = () => {
                const state = getDiagnosticState();
                const allModuleButtons = document.querySelectorAll('.module-button:not(#results-btn)');
                
                allModuleButtons.forEach(button => {
                    const moduleKey = button.dataset.moduleKey;
                    if (state[moduleKey]) {
                        button.classList.add('completed');
                    } else {
                        button.classList.remove('completed');
                    }
                });
                
                const resultsBtn = document.getElementById('results-btn');
                const allModulesCompleted = state.DT_T0_RW_M1_completed && state.DT_T0_RW_M2_completed && state.DT_T0_MT_M1_completed && state.DT_T0_MT_M2_completed;
                
                resultsBtn.classList.toggle('active', allModulesCompleted);
            };

            document.querySelectorAll('.module-button').forEach(button => {
                button.addEventListener('click', function(event) {
                    event.preventDefault(); // Always stop immediate navigation
                    const state = getDiagnosticState();
                    const moduleKey = this.dataset.moduleKey;

                    // Logic for View Results button
                    if (this.id === 'results-btn') {
                        if (this.classList.contains('active')) {
                            window.location.href = this.href;
                        } else {
                            alert("Please complete all four modules before viewing the results.");
                        }
                        return;
                    }

                    // Logic for Module buttons
                    if (state[moduleKey]) { // If module is already completed
                        alert("You have already submitted this module.");
                        return;
                    }

                    // If not completed, check for email and proceed
                    targetUrl = this.href;
                    const storedEmail = localStorage.getItem('bluebookStudentEmail');
                    if (storedEmail && storedEmail.includes('@')) {
                        window.location.href = targetUrl;
                    } else {
                        emailModal.classList.add('visible');
                    }
                });
            });

            // Email modal submission logic remains the same
            emailSubmitBtn.addEventListener('click', () => {
                const email = emailInput.value.trim();
                if (email && email.includes('@')) {
                    localStorage.setItem('bluebookStudentEmail', email);
                    window.location.href = targetUrl;
                } else {
                    alert("Please enter a valid email address.");
                }
            });

            // Reset button logic remains the same
            document.getElementById('reset-progress-btn').addEventListener('click', () => {
                if (confirm("Are you sure you want to reset all progress for this diagnostic test?")) {
                    localStorage.removeItem(DIAGNOSTIC_STATE_KEY);
                    updateVisuals();
                }
            });

            // Initial visual update on page load
            updateVisuals();
        });
    </script>
</body>
</html>
